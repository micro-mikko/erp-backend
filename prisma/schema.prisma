generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Company {
  id                  String    @id @default(cuid())
  name                String
  businessId          String    @unique
  address             String?
  city                String?
  postalCode          String?
  country             String    @default("FI")
  vatLiable           Boolean   @default(true)
  vatReportingPeriod  String    @default("monthly")
  fiscalYearEnd       String    @default("12-31")
  languagePreference  String    @default("sv")
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  
  users               User[]
  accounts            Account[]
  transactions        Transaction[]
  invoices            Invoice[]
  customers           Customer[]
  expenses            Expense[]
}

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  passwordHash  String
  name          String
  role          String   @default("user")
  companyId     String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  company       Company  @relation(fields: [companyId], references: [id])
}

model Account {
  id              String            @id @default(cuid())
  accountNumber   String
  nameSv          String
  nameFi          String?
  type            String
  vatRate         Float?
  isActive        Boolean           @default(true)
  companyId       String
  createdAt       DateTime          @default(now())
  
  company         Company           @relation(fields: [companyId], references: [id])
  transactionLines TransactionLine[]
  
  @@unique([companyId, accountNumber])
}

model Transaction {
  id              String            @id @default(cuid())
  voucherNumber   String
  date            DateTime
  description     String
  categoryId      String?
  subcategoryId   String?
  companyId       String
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  
  company         Company           @relation(fields: [companyId], references: [id])
  lines           TransactionLine[]
}

model TransactionLine {
  id              String      @id @default(cuid())
  transactionId   String
  accountId       String
  debit           Float       @default(0)
  credit          Float       @default(0)
  description     String?
  vatRate         Float?
  vatAmount       Float?
  
  transaction     Transaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)
  account         Account     @relation(fields: [accountId], references: [id])
}

model Invoice {
  id              String        @id @default(cuid())
  invoiceNumber   String
  customerId      String
  issueDate       DateTime
  dueDate         DateTime
  status          String        @default("draft")
  subtotal        Float
  vatAmount       Float
  total           Float
  companyId       String
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  company         Company       @relation(fields: [companyId], references: [id])
  customer        Customer      @relation(fields: [customerId], references: [id])
  lines           InvoiceLine[]
}

model InvoiceLine {
  id              String   @id @default(cuid())
  invoiceId       String
  description     String
  quantity        Float
  unitPrice       Float
  vatRate         Float
  amount          Float
  
  invoice         Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
}

model Customer {
  id              String    @id @default(cuid())
  name            String
  businessId      String?
  address         String?
  city            String?
  postalCode      String?
  country         String?
  email           String?
  phone           String?
  companyId       String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  company         Company   @relation(fields: [companyId], references: [id])
  invoices        Invoice[]
}

model Expense {
  id              String   @id @default(cuid())
  date            DateTime
  description     String
  amount          Float
  vatAmount       Float?
  category        String?
  supplier        String?
  receiptUrl      String?
  companyId       String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  company         Company  @relation(fields: [companyId], references: [id])
}
